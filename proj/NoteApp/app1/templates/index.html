{% extends 'base.html' %}
{% load static %}
{% block content %}


    <div id="mynetwork" class="center-block" style="margin-top: 60px;"></div>
    <div class="text-center" style="margin-top: 30px;">

        <button class="btn btn-success" onclick="addNewNode('{{ focusPath }}');">Add new node</button>
        <button class="btn btn-warning" data-toggle="modal" data-target="#nodenamemodal">Edit the node name</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#deletenodemodal">Delete the node</button>
        <button class="btn btn-primary" onclick="navigateToParent('{{ focusPath }}');">Back to parent</button>
    </div>

    <div id="nodenamemodal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit node name</h4>
              </div>
              <div class="modal-body">
                <input id="editedfocusname" type="text" value="{{ focusName }}" />
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary" onclick="editTheNode('{{ focusPath }}','{{ focusName }}')" data-dismiss="modal">Save</button>
              </div>
            </div>
        </div>
    </div>

    <div id="deletenodemodal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Delete node</h4>
              </div>
              <div class="modal-body">
                <p>Are you sure? It will delete the node and every child node of it! </p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default btn-danger" onclick="deleteTheNode('{{ focusPath }}');" data-dismiss="modal">Delete</button>
              </div>
            </div>
        </div>
    </div>

    <style type="text/css">
        #mynetwork {
            width: 800px;
            height: 500px;
            alignment: center;
            border: 1px solid lightgray;
        }
    </style>

    <script type="text/javascript">

        var childDirLabels = "{{ focusDirNames|safe }}".replace(/\'/ig,'\"').trim();
        childDirLabels = JSON.parse(childDirLabels);
        var childDirNames = "{{ focusDirs|safe }}".replace(/\'/ig,'\"').trim();
        childDirNames = JSON.parse(childDirNames);

        var childDirSize = childDirLabels.length;

        var nodeData = [];
        nodeData.push( {id: 1, group: 'focus', label: '{{ focusName }}'} );
        for(var ii = 0;ii< childDirSize; ii++){nodeData.push( {id: ii+2, label: childDirLabels[ii] } );}
        var nodes = new vis.DataSet(nodeData);


        var edgeData = [];
        for(var ii = 0;ii< childDirSize; ii++){edgeData.push( {from: 1, to: ii+2 ,length: 150} );}
        var edges = new vis.DataSet(edgeData);


        var container = document.getElementById('mynetwork');
        var data = {nodes: nodes,edges: edges,};
        var options = {
          layout:{
              hierarchical:{
                  enabled: true,
                  levelSeparation: 170,
              },
          },
          edges:{
              smooth: {
                  enabled: true,
                  type: "horizontal",
                  roundness: 0.55
                },
          },
          nodes:{
            shape : 'box',
            scaling: {label: {enabled: true,},},
            font: '25px arial black',
            margin: 15,
          },
          groups: {
            focus: {color:{background:'green',border:'black',highlight:{background:'green',border:'black'}},borderWidth:4}
          },
        };

        // initialize your network!
        var network = new vis.Network(container, data, options);

        network.on("click",function (nwparams) {
            var clickedNodeId = nwparams['nodes'][0]

            if(clickedNodeId != undefined){
                var clickedNode = nodes.get(clickedNodeId);
                var clickedName = clickedNode["label"]

                if(clickedName == "{{ focusName }}"){
                    window.location.href = "/node?path="+"{{ focusPath }}";
                }

                var clickedDirIndex = childDirLabels.indexOf(clickedName);
                var clickedDirName = childDirNames[clickedDirIndex];
                if(clickedDirName != undefined){
                    window.location.href = "/index?path="+"{{ focusPath }}"+"/"+clickedDirName;
                }
            }
        });

    </script>

{% endblock content %}
